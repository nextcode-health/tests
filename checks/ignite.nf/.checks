#
# Run with Ignite exector standalone mode
# 
$NXF_RUN -process.executor ignite | tee stdout

[[ `< .nextflow.log grep -c 'executor > ignite'` == 1 ]] || false
[[ `< .nextflow.log grep -c 'Submitted process'` == 5 ]] || false

#
# Launch a nextflow daemon in background  
# 
$NXF_CMD node & 
sleep 5 
[[ `< .node-nextflow.log grep -c 'ROLE=worker'` == 1 ]] || false

#
# Launch execution using worker node
#
$NXF_RUN -process.executor ignite | tee stdout 
[[ `< .nextflow.log grep -c 'ROLE=master'` == 1 ]] || false
[[ `< .nextflow.log grep -c 'executor > ignite'` == 1 ]] || false
[[ `< .nextflow.log grep -c 'Submitted process'` == 5 ]] || false


#
# Launch in resume mode and forcing worker node shutdown
#
NXF_CLUSTER_SHUTDOWNONCOMPLETE='true' $NXF_RUN -process.executor ignite -resume | tee stdout
[[ `< .nextflow.log grep -c 'Cached process'` == 5 ]] || false

#
# Check worker hs stopped
#
sleep 1 
[[ `< .node-nextflow.log grep -c 'SPI stopped ok'` > 0 ]] || false
