#
# run normal mode
#
$NXF_RUN | tee stdout

[[ `grep INFO .nextflow.log | grep -c 'Submitted process > align'` == 3 ]] || false
[[ `grep INFO .nextflow.log | grep -c 'Submitted process > combine'` == 1 ]] || false
cmp stdout .expected || false

[[ -f data/alpha.bai ]] || false
[[ -f data/alpha.bam ]] || false
[[ -f data/beta.bai ]] || false
[[ -f data/beta.bam ]] || false
[[ -f data/delta.bai ]] || false
[[ -f data/delta.bam ]] || false
[[ -L data/result.txt ]] || false
[[ -f data/xxx/A ]] || false
[[ -f data/xxx/B ]] || false
[[ -f data/xxx/C ]] || false


rm -rf data

#
# run resume mode
#
$NXF_RUN -resume | tee stdout

[[ `grep INFO .nextflow.log | grep -c 'Cached process > align'` == 3 ]] || false
[[ `grep INFO .nextflow.log | grep -c 'Cached process > combine'` == 1 ]] || false
cmp stdout .expected || false
[[ -f data/alpha.bai ]] || false
[[ -f data/alpha.bam ]] || false
[[ -f data/beta.bai ]] || false
[[ -f data/beta.bam ]] || false
[[ -f data/delta.bai ]] || false
[[ -f data/delta.bam ]] || false
[[ -L data/result.txt ]] || false
[[ -f data/xxx/A ]] || false
[[ -f data/xxx/B ]] || false
[[ -f data/xxx/C ]] || false
